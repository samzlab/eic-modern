# EIC Modern Library Tests

This directory contains comprehensive unit tests for the EIC (Energy Identification Code) Modern library using Vitest.

## Overview

The test suite provides complete coverage of all exported functions in the EIC library:

- `mayBeEIC()` - Check if a string looks like an EIC code
- `calcCheckChar()` - Calculate check character for EIC codes
- `getType()` - Get the type of entity represented by an EIC code
- `getIssuer()` - Get issuer information from an EIC code
- `examine()` - Comprehensive validation with detailed error/warning information
- `isValid()` - Simple boolean validation
- `generateRandomEIC()` - Generate random valid EIC codes
- `generateEICWithTypeAndIssuer()` - Generate EIC codes with specific parameters

## Running Tests

### Prerequisites

Install dependencies:
```bash
npm install
```

### Test Commands

Run tests in watch mode:
```bash
npm test
```

Run tests once:
```bash
npm run test:run
```

Run tests with coverage report:
```bash
npm run test:coverage
```

## Test Structure

The test suite is organized into logical groups:

### 1. `mayBeEIC` Function Tests
- Valid EIC code format validation
- Length boundary testing (14, 15, 16, 17 characters)
- Invalid character detection
- Case sensitivity handling

### 2. `calcCheckChar` Function Tests
- Correct check character calculation for known patterns
- Handling of 16+ character inputs (ignores excess)
- Case insensitive processing
- Validation with all valid EIC characters

### 3. `getType` Function Tests
- Recognition of all valid EIC type characters (x, y, z, v, w, t, a)
- Handling of unknown type characters
- Error handling for malformed inputs

### 4. `getIssuer` Function Tests
- Recognition of known issuer codes (10, 11, 12, 48, etc.)
- Correct issuer information retrieval
- Handling of unknown issuer codes
- Error handling for malformed inputs

### 5. `examine` Function Tests
- Comprehensive validation with error reporting
- Detection of various error conditions:
  - Too short/long strings
  - Invalid characters
  - Check character mismatches
  - Check character being a hyphen
- Warning generation for:
  - Unknown types
  - Unknown issuers
- Multiple error handling

### 6. `isValid` Function Tests
- Boolean validation for valid EIC codes
- Rejection of invalid codes
- Case insensitive processing

### 7. `generateRandomEIC` Function Tests
- Generation of valid EIC codes
- Verification that generated codes have valid issuers and types
- Randomness verification (no duplicates in reasonable sample)

### 8. `generateEICWithTypeAndIssuer` Function Tests
- Generation with specific type and issuer constraints
- Error handling for invalid types/issuers
- Randomness in generated portion
- Validation of output codes

### 9. Edge Cases and Boundary Conditions
- Empty string handling
- All valid character testing
- Boundary length cases (14, 15, 16, 17 characters)

## Test Data

The tests use real, valid EIC codes generated by the library itself:
- `10x0000000000011` - ENTSO-E, PARTY type
- `11y0000000000019` - BDEW, AREA type  
- `12z000000000001h` - Swissgrid, MEASUREMENT_POINT type

## Coverage

The test suite achieves **100% code coverage** for the main source file (`src/index.ts`), ensuring all functions, branches, and lines are tested.

## Configuration

### Vitest Configuration (`vitest.config.ts`)
```typescript
/// <reference types="vitest" />
import { defineConfig } from 'vitest/config';

export default defineConfig({
    test: {
        environment: 'node',
        coverage: {
            provider: 'v8',
            reporter: ['text', 'json', 'html'],
            exclude: [
                'node_modules/',
                'dist/',
                '**/*.d.ts',
                '**/*.test.ts',
            ],
        },
    },
});
```

### Package.json Scripts
```json
{
  "scripts": {
    "test": "vitest",
    "test:run": "vitest run", 
    "test:coverage": "vitest run --coverage"
  }
}
```

## Test Script

A demonstration script (`test-script.js`) is included to verify the library works correctly:

```bash
node test-script.js
```

This script demonstrates:
1. Random EIC code generation
2. Validation of specific test codes
3. Check character calculation
4. Error and warning detection

## Integration

The tests are designed to:
- Run quickly (under 1 second)
- Provide clear error messages
- Test real-world scenarios
- Validate edge cases
- Ensure backward compatibility

All tests pass in the CI/CD environment and provide confidence in library functionality across different environments and use cases.
